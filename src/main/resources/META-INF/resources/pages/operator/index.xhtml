<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">
<title>
    User: #{checkOperator.login}
</title>
<h:head>
    <h:outputStylesheet name="primefaces/components.css"/>
    <h:outputStylesheet name="style/style.css"/>
    <h:outputScript name="style/js/ru.js"/>
    <h:outputScript name="style/js/googleMapsApi.js"/>

    <script defer="defer" type="text/javascript"
            src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCpraOK2IzV4OR_h5Gi8YbCnUL4OFDaeSs&amp;libraries=places&amp;callback=initMap">
    </script>
</h:head>
<h:body>
    <p:growl showDetail="false">
        <p:autoUpdate/>
    </p:growl>

    <p:layout fullPage="true" style="border: 0" >
        <!--TOP-->
        <p:layoutUnit id="top" position="north" size="50">
            <h:form>
                <p:outputLabel value="Оператор: #{checkOperator.name} #{checkOperator.lastName}"/>
                <p:clock pattern="HH:mm:ss dd.MM.yyyy" mode="server" style="float: right"/>
            </h:form>
        </p:layoutUnit>
        <!--CENTER-->
        <p:layoutUnit id="center" position="center">
            <h:form id="centerForm">
                <p:panelGrid columns="2" id="orderForm" style="width: 100%" columnClasses="column-center-form">
                    <p:outputLabel value="Телефон"/>
                    <p:inputText id="clientPhonenumber" value="#{takeOrder.clientPhoneNumber}"
                                 size="50"
                                 required="true" requiredMessage="Телефон">
                            <f:validateRegex pattern="((?=.*[0-9])(?=.*[+]).{13})"/>
                    </p:inputText>

                    <p:outputLabel value="Откуда"/>
                    <p:inputText id="input-from" value="#{takeOrder.fromAddress}" widgetVar="fromAddress"
                                 size="50" required="true" requiredMessage="Поле Откуда обязательное"/>

                    <p:outputLabel value="Куда"/>
                    <p:inputText id="input-to" value="#{takeOrder.toAddress}" widgetVar="toAddress"
                                 size="50" required="true" requiredMessage="Поле Куда обязательное"/>

                    <p:outputLabel for="datetime" value="Время:" />
                    <p:calendar id="datetime" value="#{takeOrder.onDate}" pattern="MM/dd/yyyy HH:mm"
                                showTodayButton="true" showButtonPanel="true" locale="ru" lang="ru" required="true"
                                requiredMessage="Поле Дата обязательное"/>

                    <p:importEnum type="com.vozup.givemetaxi.CarType" var="CarType" allSuffix="ALL_ENUM_VALUES"/>
                    <p:outputLabel for="car" value="Авто:"/>
                    <p:selectOneRadio id="car" value="#{takeOrder.carType}"
                                      required="true" style="text-align:left"
                                      requiredMessage="Обязательное поле">
                        <f:selectItem itemLabel="Стандарт" itemValue="#{CarType.STANDART}"/>
                        <f:selectItem itemLabel="Комфорт" itemValue="#{CarType.COMFORT}" />
                        <f:selectItem itemLabel="Бизнес" itemValue="#{CarType.BUISNESS}" />
                        <f:selectItem itemLabel="Универсал" itemValue="#{CarType.UNIVERSAL}" />
                        <f:selectItem itemLabel="Микроавтобус" itemValue="#{CarType.MICROBUS}" />
                    </p:selectOneRadio>

                    <p:outputLabel for="additionalService" value="Дополнительные услуги:"/>
                    <p:selectManyCheckbox id="additionalService" value="#{additionalService.selectedAdditionalService}"
                                          layout="grid" columns="3">
                        <f:selectItems value="#{additionalService.additionalServiceSet}" var="service"
                                       itemLabel="#{service}" itemValue="#{service}" />
                    </p:selectManyCheckbox>

                    <p:outputLabel for="messageForDriver" value="Дополнительная информация для водителя"/>
                    <p:inputTextarea id="messageForDriver" value="#{takeOrder.otherInfoToDriver}"/>

                    <p:outputLabel value="Цена"/>
                    <p:inputText value="#{takeOrder.price} грн." id="price" disabled="true"/>

                    <p:button value="Проложить маршрут" onclick="calcRoute(); return false;"/>

                    <p:commandButton value="В обработку" action="#{takeOrder.actionTakeOrder}"
                                     update="centerForm"/>
                </p:panelGrid>
            </h:form>
            <div id="map" style="width: 100%; height: 230px"/>
            <h:form id="formResult">
                <p:inputText type="hidden" widgetVar="distanceText" value="#{takeOrder.distanceText}"/>
                <p:inputText type="hidden" widgetVar="distanceValue" value="#{takeOrder.distanceValue}"/>
                <p:inputText type="hidden" widgetVar="resultCarType" value="#{takeOrder.carType}"/>
                <p:commandButton widgetVar="sendResults" style="display: none;"
                                 actionListener="#{takeOrder.calculatePrice}"
                                 update="centerForm:price"/>
            </h:form>


        </p:layoutUnit>
        <!--LEFT-->
        <p:layoutUnit id="left" position="west" size="300" resizable="false" closable="false" collapsible="true"
                      header="Очередь заказов и сообщений">

            <p:accordionPanel id="calls">
                <p:tab title="Очередь звонков">
                    <h:form>
                                <p:repeat var="call" value="#{callList.calls}"
                                          mode="inline" scrollHeight="260" styleClass="leftContainer">
                                    <p:outputPanel>
                                        <p:commandButton update="calls,centerForm:clientPhonenumber"
                                                         value="#{call.phoneNumber}" action="#{callList.answer}"
                                                         style="width: 100%">
                                            <f:setPropertyActionListener value="#{call}" target="#{callList.selectedCall}" />
                                        </p:commandButton>
                                    </p:outputPanel>
                                </p:repeat>
                    </h:form>
                </p:tab>

                <p:tab title="Очередь сообщений">
                    <h:outputText value="Menu 2 Content" />
                </p:tab>

            </p:accordionPanel>
        </p:layoutUnit>
        <!--RIGHT-->
        <p:layoutUnit id="right" position="east" size="25%" header="Доступные машины" resizable="false" closable="false"
                      style="margin-left: 0"
                      collapsible="true" >

            <h:form id="driverDetailForm">
                <p:growl id="driverDetailmsg" showDetail="false" />

                <p:dataTable id="driverDT" value="#{showDriver.drivers}" var="driver" style="font-size: 12px">
                    <p:column>
                        <h:outputText value="#{driver.firstName}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{driver.car.carType}" />
                    </p:column>
                    <p:column>
                        <h:outputText value="#{driver.car.carNumber}" />
                    </p:column>
                    <p:column style="width:16px;text-align: center">
                        <p:commandButton oncomplete="PF('driverDialog').show()"
                                         update="driverDialog"
                                         icon="ui-icon-search" title="View">
                            <f:setPropertyActionListener target="#{showDriver.selectedDriver}" value="#{driver}"  />
                        </p:commandButton>
                    </p:column>
                </p:dataTable>
            </h:form>
        </p:layoutUnit>

        <p:dialog id ="driverDialog" header="Driver Info" widgetVar="driverDialog" modal="true"
                  showEffect="fade" hideEffect="fade" resizable="true">
            <p:outputPanel id="driverDetail" style="text-align:center;">
                <p:panelGrid  columns="2">

                    <h:outputText value="Id:" />
                    <h:outputText value="#{showDriver.selectedDriver.id}" />

                    <h:outputText value="FirstName" />
                    <h:outputText value="#{showDriver.selectedDriver.firstName}" />

                    <h:outputText value="LastName:" />
                    <h:outputText value="#{showDriver.selectedDriver.lastName}"/>

                    <h:outputText value="Phone Number:" />
                    <h:outputText value="#{showDriver.selectedDriver.phoneNumber}"/>

                    <h:outputText value="Car Brand:" />
                    <h:outputText value="#{showDriver.selectedDriver.car.carBrand}"/>

                    <h:outputText value="Car Model:" />
                    <h:outputText value="#{showDriver.selectedDriver.car.carModel}"/>
                </p:panelGrid>
            </p:outputPanel>
        </p:dialog>

    </p:layout>

</h:body>
</html>